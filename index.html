<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 4</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(900, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
  game.load.image('sky', 'https://cloud.githubusercontent.com/assets/8300539/6668277/b95dcb6c-cc17-11e4-9a2b-aa22bcfd350f.png');
  game.load.image('ground', 'https://cloud.githubusercontent.com/assets/8300539/6668276/b94c87c6-cc17-11e4-8d81-b84fc520b71c.png'); 
  game.load.image('a', 'https://cloud.githubusercontent.com/assets/8300539/6668228/5b55cbf0-cc17-11e4-8741-48bc44d863d4.png');  
  game.load.image('b', 'https://cloud.githubusercontent.com/assets/8300539/6668229/5b5c0132-cc17-11e4-8c4c-43a36ca49453.png');
  game.load.image('c', 'https://cloud.githubusercontent.com/assets/8300539/6668232/5b6d43d4-cc17-11e4-953b-c4eff4d9c810.png');
  game.load.image('d', 'https://cloud.githubusercontent.com/assets/8300539/6668231/5b6d5ce8-cc17-11e4-9acb-31e5a9d8efa2.png');
  game.load.image('e', 'https://cloud.githubusercontent.com/assets/8300539/6668230/5b6c36ce-cc17-11e4-82af-86cdefb30296.png');
  game.load.bitmapFont('scorefont', 'https://github.com/photonstorm/phaser-examples/blob/master/examples/assets/fonts/bitmapFonts/nokia.png', 'https://github.com/photonstorm/phaser-examples/blob/master/examples/assets/fonts/bitmapFonts/nokia.xml');
}


var numStars = 50;
var scoreText;
var score = 0;
var frameRate = 50;
var stars;
var ground;
var platforms;
var cursor;
var displayLetter;
function create() {
  game.physics.startSystem(Phaser.Physics.ARCADE);
  game.add.sprite(0, 0, 'sky');
  stars = game.add.group();
  
  stars.enableBody = true;
  var letter = String.fromCharCode(97 + Math.floor(Math.random() * 5));
  displayLetter = stars.create(9 * 90, 0, letter);
  createSingle();
  platforms = game.add.group();
  platforms.enableBody = true;
  var ground = platforms.create(0,game.world.height-64, 'ground');
  ground.scale.setTo(2, 2);
  ground.body.immovable = true;
  score=0;
  scoreText = this.game.add.bitmapText(9 * 90, 150, 'scorefont', score.toString(), 48);
  scoreText.visible = true;
}
var frameCount = 0;
function update() {
  
  game.physics.arcade.overlap(stars, platforms, collectStar, null, this);
  
  frameCount = (frameCount % (5*frameRate+1)) + 1;
  if (frameCount % frameRate == 0) {
      createSingle();
      
  }
  if (frameCount % (5 * frameRate) == 0) {
      displayLetter.kill();
      var letter = String.fromCharCode(97 + Math.floor(Math.random() * 5));
      displayLetter = stars.create(9 * 90, 0, letter);
  }
}
   
function collectStar(star, g) {
  star.kill(); 
  
}
var mycount = 0;
function createSingle() {
    var num = getRandomInt(1, 3);
    for (var n = 0; n < num; n++) {
        var x = getRandomInt(0, 8);
        var letter = String.fromCharCode(97 + Math.floor(Math.random() * 5));
        
        var star = stars.create(x*90, 0, letter);
        star.inputEnabled = true;
        star.events.onInputDown.add(onDown, this);
        
        star.body.gravity.y = 150;
        star.body.bounce.y = 0.7 + Math.random() * 0.2;
    }

}

function onDown(sprite, pointer) {
    if (sprite.key == displayLetter.key) {
        this.score++;
        scoreText.setText(score.toString());
    }
    else {
        this.score--;
        scoreText.setText(score.toString());
    }
    sprite.kill();
    
}
function test(event, sprite)
{
  console.log(sprite);  
}

/**
 * Returns a random number between min (inclusive) and max (exclusive)
 */
function getRandomArbitrary(min, max) {
    return Math.random() * (max - min) + min;
}

/**
 * Returns a random integer between min (inclusive) and max (inclusive)
 * Using Math.round() will give you a non-uniform distribution!
 */
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
</script>
